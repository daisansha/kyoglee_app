{% extends "base/accounting_base.html" %}
{% load custom_filters %}
{% block body %}

<div class="contents">
    <div class="register_contents">
    <div style="display: flex; gap: 20px; width: 100%;">
    <h2 class="page_name">{{ cash_page.title }}（{{ cash_page.year }}年）</h2>

    <!-- 出入金管理表 -->
    <h3>出入金管理表</h3>
    <!-- 出入金項目追加ボタン -->
    <button class="button_wrapper">
        <a href="{% url 'accounting:cash_item_add' pk=cash_page.id %}" class="button">出入金項目を追加</a>
    </button>  
    <h4>収入</h4>
    <table class="spacious-table" border="1">
        <thead><tr><th>日付</th><th>項目</th><th>金額</th></tr></thead>
        <tbody>
            {% for item in income_items %}
            <tr>
                <td>{{ item.date|date:"n/j" }}</td>
                <td><a href="{% url 'accounting:cash_item_detail' pk=cash_page.id item_id=item.id %}">{{ item.description }}</a></td>
                <td>{{ item.amount }}</td>
            </tr>
            {% endfor %}
            <tr><td colspan="2"><strong>収入計</strong></td><td>{{ income_total }}</td></tr>
        </tbody>
    </table>

<h4>支出</h4>
<table class="spacious-table" border="1">
    <thead><tr><th>日付</th><th>項目</th><th>金額</th></tr></thead>
    <tbody>
        {% for item in expense_items %}
        <tr>
            <td>{{ item.date|date:"n/j" }}</td>
            <td><a href="{% url 'accounting:cash_item_detail' pk=cash_page.id item_id=item.id %}">{{ item.description }}</a></td>
            <td>{{ item.amount }}</td>
        </tr>
        {% endfor %}
        <tr><td colspan="2"><strong>支出計</strong></td><td>{{ expense_total }}</td></tr>
    </tbody>
</table>

<!-- 総計 -->
<h4>総計</h4>
<table class="spacious-table" border="1">
    <tbody>
        <tr>
            <th>収入計</th>
            <td>{{ income_total }}</td>
        </tr>
        <tr>
            <th>支出計</th>
            <td>{{ expense_total }}</td>
        </tr>
        <tr>
            <th>差額</th>
            <td>{{ balance }}</td>
        </tr>
    </tbody>
</table>

    <!-- 予実管理表 -->
    <h3>予実管理表</h3>
    <!-- ステータス -->
    <div><p>予算：{{ cash_page.approval_status }}</p></div>
<table class="spacious-table" border="1">
    <thead>
        <tr><th>科目</th><th>予算</th><th>実費</th></tr>
    </thead>
    <tbody>
        <!-- 収入項目 -->
        <tr><td colspan="3"><strong>収入</strong></td></tr>
        {% for label in income_labels %}
        <tr>
            <td>{{ label }}</td>
            <td>{{ budget_values|get_item:label|default:0 }}</td>
            <td>{{ actuals|get_item:label|default:0 }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td><strong>収入計</strong></td>
            <td>{{ income_budget_total }}</td>
            <td>{{ income_actual_total }}</td>
        </tr>

        <!-- 支出項目 -->
        <tr><td colspan="3"><strong>支出</strong></td></tr>
        {% for label in expense_labels %}
        <tr>
            <td>{{ label }}</td>
            <td>{{ budget_values|get_item:label|default:0 }}</td>
            <td>{{ actuals|get_item:label|default:0 }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td><strong>支出計</strong></td>
            <td>{{ expense_budget_total }}</td>
            <td>{{ expense_actual_total }}</td>
        </tr>

<!-- 差額 -->
<tr>
    <td><strong>差額</strong></td>
    <td>{{ budget_diff }}</td>
    <td>{{ actual_diff }}</td>
</tr>
    </tbody>
</table>
    <br>
    <button class="button_wrapper">
        <a href="{% url 'accounting:cash_plan_update' pk=cash_page.id %}" class="button"> 予算を更新 </a>
    </button>

    <!-- 会計表削除ボタン -->
    <button class="button_wrapper">
        <a href="{% url 'accounting:cash_page_delete' pk=cash_page.id %}" class="button"> 会計表を削除 </a>
    </button>
    
</div>

<style>
    .spacious-table th,
    .spacious-table td {
        padding: 8px;
    }
</style>

{% endblock %}
